import{j as e,D as t,h as s,r as a,i as r}from"./vendor.CaVeaJ46.js";import{T as d,a as m,b as n,c as i,I as l}from"./input.CJzTHajJ.js";import{M as o,C as c,a as x}from"./MainLayout.D8bZoW3k.js";import{s as u,G as p,i as h,C as g,H as f}from"./data.BAESVmt3.js";import{c as b}from"./index.DDEQmIFh.js";import{b as y,B as j}from"./button.Dbb4DWlm.js";import{h as v,e as w,S as N,i as k}from"./ui.CtzC-6wT.js";import{P as C,a as D,b as _}from"./popover.D82tYQ7w.js";import"./charts.Cj5jtLqc.js";function T({className:s,classNames:a,showOutsideDays:r=!0,...d}){return e.jsx(t,{showOutsideDays:r,className:b("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:b(y({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:b(y({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:({...t})=>e.jsx(v,{className:"h-4 w-4"}),IconRight:({...t})=>e.jsx(w,{className:"h-4 w-4"})},...d})}T.displayName="Calendar";const M=[{id:"札幌",name:"札幌"},{id:"函館",name:"函館"},{id:"福島",name:"福島"},{id:"新潟",name:"新潟"},{id:"東京",name:"東京"},{id:"中山",name:"中山"},{id:"中京",name:"中京"},{id:"京都",name:"京都"},{id:"阪神",name:"阪神"},{id:"小倉",name:"小倉"}],S=a.memo(i),I=a.memo((({race:t,onClick:s})=>{const r=a.useMemo((()=>g(new Date(t.startTime),"MM/dd(E)",{locale:f})),[t.startTime]),d=a.useMemo((()=>g(new Date(t.startTime),"HH:mm")),[t.startTime]);return e.jsxs(c,{className:"cursor-pointer group relative overflow-hidden bg-background/70 backdrop-blur-sm border-primary/20 hover:bg-primary/5 transition-all duration-300 hover:scale-[1.01] hover:-translate-y-0.5 hover:shadow-md rounded-lg sm:rounded-lg md:rounded-xl",onClick:s,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/10 via-background/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx(x,{className:"relative p-3 sm:p-4 md:p-5",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-base sm:text-lg md:text-lg text-foreground/90 group-hover:text-primary transition-colors duration-300",children:t.name}),e.jsxs("p",{className:"text-xs sm:text-sm md:text-sm text-muted-foreground flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:r}),e.jsx("span",{className:"inline-flex items-center justify-center bg-primary/20 px-2 py-0.5 rounded-full text-primary text-xs font-medium",children:d})]})]}),e.jsxs("div",{className:"text-right",children:["done"===t.status&&e.jsx("p",{className:"text-xs sm:text-sm md:text-sm font-medium text-foreground/80 bg-primary/10 px-2 sm:px-2.5 md:px-3 py-0.5 sm:py-0.5 md:py-1 rounded-full",children:"発走済"}),e.jsxs("p",{className:"text-[10px] sm:text-xs md:text-xs text-muted-foreground mt-1 sm:mt-1.5 md:mt-2",children:["ID: ",t.id]})]})]})})]})})),A=a.memo((({searchQuery:t})=>e.jsx("div",{className:"text-center text-muted-foreground py-8 sm:py-10 md:py-12 bg-background/70 backdrop-blur-sm rounded-xl border border-primary/20 shadow-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-2.5 md:gap-3",children:[e.jsx(N,{className:"h-8 w-8 sm:h-9 sm:w-9 md:h-10 md:w-10 text-primary/30"}),e.jsx("p",{className:"text-base sm:text-base md:text-lg font-medium",children:t?"検索結果が見つかりません":"レースがありません"})]})}))),E=a.memo((()=>e.jsx("div",{className:"text-center text-muted-foreground py-12 sm:py-14 md:py-16 bg-background/70 backdrop-blur-sm rounded-xl border border-primary/20 shadow-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 sm:gap-3.5 md:gap-4",children:[e.jsx(k,{className:"h-10 w-10 sm:h-11 sm:w-11 md:h-12 md:w-12 text-primary/30"}),e.jsx("p",{className:"text-lg sm:text-lg md:text-xl font-medium",children:"開催中のレースはありません"})]})}))),Q=a.memo((({selectedDate:t,setSelectedDate:s,searchQuery:a,setSearchQuery:r,setShowAllVenues:d})=>e.jsxs("div",{className:"relative overflow-hidden rounded-xl bg-gradient-to-t from-background to-primary/10 p-3 sm:p-5 md:p-6 mb-3 sm:mb-6 md:mb-8 shadow-sm",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-primary/5 [mask-image:linear-gradient(to_bottom,transparent_20%,black_70%)]"}),e.jsxs("div",{className:"relative flex justify-between items-start gap-2 sm:gap-4 md:gap-5",children:[e.jsxs("div",{className:"hidden sm:flex flex-col gap-1 md:gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold bg-gradient-to-br from-foreground to-foreground/70 bg-clip-text text-transparent whitespace-nowrap",children:"レース一覧"}),e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground bg-primary/5 px-2 md:px-3 py-0.5 md:py-1 rounded-full whitespace-nowrap",children:"競馬予想・回収率アップ"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground max-w-md",children:"AIで的中率と期待値を最適化"})]}),e.jsxs("div",{className:"flex w-full sm:w-auto justify-between sm:justify-end items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"order-1",children:e.jsxs(C,{children:[e.jsx(D,{asChild:!0,children:e.jsxs(j,{variant:"outline",size:"sm",className:"flex items-center gap-1 sm:gap-1.5 md:gap-2 bg-background/80 backdrop-blur-sm border-primary/20 hover:bg-primary/10 transition-all duration-300 text-[14px] sm:text-xs md:text-sm h-8 sm:h-8 md:h-9 px-2.5 sm:px-3",children:[e.jsx(k,{className:"h-3.5 w-3.5 sm:h-3.5 md:h-4 sm:w-3.5 md:w-4 text-primary"}),g(t,"yyyy/MM/dd")]})}),e.jsx(_,{className:"w-auto p-0 border-primary/20 shadow-lg",children:e.jsx(T,{mode:"single",selected:t,onSelect:s,locale:f,disabled:e=>e>new Date,className:"rounded-lg border border-primary/10"})})]})}),e.jsxs("div",{className:"relative w-1/2 sm:w-48 md:w-54 order-2",children:[e.jsx(N,{className:"absolute left-2.5 sm:left-2.5 md:left-3 top-1/2 -translate-y-1/2 text-primary h-3.5 w-3.5 sm:h-3.5 sm:w-3.5 md:h-4 md:w-4 z-10"}),e.jsx(l,{type:"text",placeholder:"レース名で検索...",value:a,onChange:e=>{r(e.target.value),d(""!==e.target.value)},className:"pl-8 sm:pl-9 md:pl-10 py-1 h-8 sm:h-9 md:h-10 bg-background/80 backdrop-blur-sm border-primary/20 focus:border-primary/50 w-full rounded-lg transition-all duration-300 focus:ring-1 sm:focus:ring-1 md:focus:ring-2 focus:ring-primary/20 text-[14px] sm:text-xs md:text-base"})]})]})]}),t.getDay()>=1&&t.getDay()<=5&&e.jsx("div",{className:"hidden sm:block mt-2 sm:mt-3",children:e.jsx("span",{className:"text-xs text-muted-foreground bg-primary/10 px-2 py-0.5 rounded-full whitespace-nowrap",children:"※平日は直前の週末のレースを表示"})})]})));function L(){var t;const[i,l]=s(),[c,x]=a.useState(""),[g,f]=a.useState(!1),[b,y]=a.useState(null),[v,w]=a.useState(new Date);a.useCallback(((e,t)=>{let s;return(...a)=>{clearTimeout(s),s=setTimeout((()=>e(...a)),t)}}),[]);const N=a.useCallback((e=>0===e.length?new Date:new Date(Math.max(...e.map((e=>new Date(e.startTime).getTime()))))),[]),k=a.useCallback((async()=>{const e=await fetch("/api/races");if(!e.ok)throw new Error("APIからデータを取得できませんでした");return e.json()}),[]),C=a.useCallback((e=>{e&&w(e)}),[]),D=a.useCallback((e=>{x(e),f(""!==e)}),[]),_=a.useCallback((e=>{const t=e.getDay();return t>=1&&t<=5?u(e,t):e}),[]),{data:T=[],isLoading:L,error:O}=p({queryKey:["/api/races"],queryFn:k,gcTime:0,staleTime:0,retry:3,refetchOnMount:!0,refetchOnWindowFocus:!0}),z=a.useCallback((e=>{l(`/race/${e}`)}),[l]),H=a.useMemo((()=>T.filter((e=>{const t=new Date(e.startTime),s=_(v);return h(t,s)||h(t,u(s,1))})).map((e=>e.venue)).filter(((e,t,s)=>s.indexOf(e)===t)).map((e=>({id:e,name:e})))),[T,v,_]),V=a.useCallback((e=>[...e].sort(((e,t)=>M.findIndex((t=>t.id===e.id))-M.findIndex((e=>e.id===t.id))))),[]),q=a.useMemo((()=>g?M:H.length>0?V(H):M),[g,H,V]),F=a.useCallback(((e,t)=>e.filter((e=>{const s=e.venue===t,a=""===c||e.name.toLowerCase().includes(c.toLowerCase())||e.id.toString().includes(c);return""!==c?s&&a:s&&a&&(()=>{const t=new Date(e.startTime),s=_(v);return h(t,s)||h(t,u(s,1))})()})).sort(((e,t)=>new Date(t.startTime).getTime()-new Date(e.startTime).getTime()))),[c,v,_]),P=a.useCallback((()=>{var e;for(const t of q)if(F(T,t.id).length>0)return t.id;return null==(e=q[0])?void 0:e.id}),[q,T,F]);return a.useMemo((()=>{var e;return c?P():null==(e=q[0])?void 0:e.id}),[c,P,q]),a.useEffect((()=>{T.length>0&&w(N(T))}),[T,N]),a.useEffect((()=>{var e;if(c){const e=P();e!==b&&y(e)}else q.length>0&&!b&&y(null==(e=q[0])?void 0:e.id)}),[c,q,b,P]),a.useEffect((()=>{var e;!(q.length>0)||b&&q.some((e=>e.id===b))||y(null==(e=q[0])?void 0:e.id)}),[q,b]),L?e.jsx(o,{children:e.jsx("div",{className:"flex justify-center items-center h-[50vh]",children:e.jsx("div",{children:"データを読み込み中..."})})}):O?e.jsx(o,{children:e.jsxs("div",{className:"flex flex-col justify-center items-center h-[50vh] gap-4",children:[e.jsx("div",{className:"text-xl font-bold text-red-500",children:"データの読み込みに失敗しました"}),e.jsx("div",{className:"text-muted-foreground text-sm max-w-md text-center",children:O instanceof Error?O.message:"サーバーとの通信中にエラーが発生しました。しばらく経ってから再度お試しください。"}),e.jsx(j,{onClick:()=>window.location.reload(),className:"mt-4",children:"再読み込み"})]})}):0===T.length?e.jsx(o,{children:e.jsx("div",{className:"flex justify-center items-center h-[50vh]",children:e.jsx("div",{children:"レースデータがありません"})})}):e.jsxs(o,{children:[e.jsxs(r,{children:[e.jsx("title",{children:"競馬予想・馬券作成アシスタント | 最新レース一覧と回収率アップの馬券戦略"}),e.jsx("meta",{name:"description",content:"競馬予想と馬券作成をサポートするAIアシスタント。最新レース情報から的中率と期待値を計算し、回収率アップのための最適な馬券戦略を提案します。初心者から上級者まで簡単に利用できる競馬予想ツール。"}),e.jsx("link",{rel:"canonical",href:"https://horse-stakes.com"}),e.jsx("meta",{name:"keywords",content:"競馬予想,馬券作成,回収率アップ,期待値,競馬AI,馬券予想,競馬攻略,馬券戦略,競馬必勝法,馬券購入,競馬初心者,競馬予想サイト"})]}),e.jsx(Q,{selectedDate:v,setSelectedDate:C,searchQuery:c,setSearchQuery:D,setShowAllVenues:f}),q.length>0?e.jsxs(d,{value:b||(null==(t=q[0])?void 0:t.id),onValueChange:y,className:"w-full",children:[e.jsxs("div",{className:"relative mb-3 sm:mb-5 md:mb-6 -mx-4 sm:mx-0",children:[e.jsx("div",{className:"overflow-x-auto scrollbar-hide will-change-transform",children:e.jsx("div",{className:"px-4 sm:px-0",children:e.jsx(m,{className:"bg-background/70 backdrop-blur supports-[backdrop-filter]:bg-background/70 rounded-lg sm:rounded-lg md:rounded-xl p-1 sm:p-1.5 md:p-1.5 flex mx-auto border border-primary/20 shadow-sm will-change-transform",style:{minWidth:"min-content"},children:q.map((t=>e.jsx(S,{value:t.id,className:"flex-shrink-0 px-3 sm:px-4 md:px-5 py-1.5 sm:py-2 md:py-2.5 text-sm data-[state=active]:bg-primary data-[state=active]:text-primary-foreground rounded-md sm:rounded-md md:rounded-lg transition-all duration-300 hover:bg-primary/10",children:t.name},t.id)))})})}),e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-6 sm:w-3 md:w-3 bg-gradient-to-r from-background via-background/100 to-background pointer-events-none"}),e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-6 sm:w-3 md:w-3 bg-gradient-to-l from-background via-background/100 to-background pointer-events-none"})]}),q.map((t=>e.jsx(n,{value:t.id,lazyMount:!1,className:"transition-opacity duration-300 ease-in-out",children:e.jsx("div",{className:"grid gap-3 sm:gap-3 md:gap-4 pb-16 md:pb-0",children:0===F(T,t.id).length?e.jsx(A,{searchQuery:c}):F(T,t.id).map((t=>e.jsx(I,{race:t,onClick:()=>z(t.id.toString())},t.id)))})},t.id)))]}):e.jsx(E,{})]})}export{L as default};
